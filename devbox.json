{
  "$schema": "https://raw.githubusercontent.com/jetify-com/devbox/0.16.0/.schema/devbox.schema.json",
  "packages": [
    "kind",
    "kubectl",
    "helm",
    "kubernetes-helm"
  ],
  "shell": {
    "scripts": {
      "cluster:start": {
        "description": "Create the Kind cluster and install Argo CD + Kargo",
        "command": "kind create cluster --name kargo-test && helm repo add argo https://argoproj.github.io/argo-helm && helm repo update argo && kubectl create namespace argocd && helm install argocd argo/argo-cd --namespace argocd --set 'configs.params.server\\.insecure=true' --wait --timeout 5m && kubectl apply -f argocd-application.yaml && echo 'Waiting for Kargo CRDs...' && until kubectl get crd projects.kargo.akuity.io 2>/dev/null; do sleep 5; done && sleep 10 && kubectl apply -f kargo/project.yaml && sleep 5 && envsubst < kargo/secret.yaml | kubectl apply -f - && kubectl apply -f kargo/warehouse.yaml && kubectl apply -f kargo/promotion-task.yaml && kubectl apply -f kargo/stages.yaml && echo '\\nArgo CD admin password:' && kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath='{.data.password}' | base64 -d && echo && echo '\\nKargo admin token:' && until kubectl -n kargo get secret kargo-admin 2>/dev/null; do sleep 5; done && kubectl -n kargo get secret kargo-admin -o jsonpath='{.data.ADMIN_BEARER_TOKEN}' | base64 -d && echo"
      },
      "cluster:stop": {
        "description": "Stop the Kind cluster",
        "command": "docker stop kargo-test-control-plane"
      },
      "cluster:delete": {
        "description": "Delete the Kind cluster",
        "command": "kind delete cluster --name kargo-test"
      }
    }
  }
}
